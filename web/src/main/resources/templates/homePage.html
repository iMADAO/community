<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=device-width,
                                     initial-scale=1.0,
                                     maximum-scale=1.0,
                                     user-scalable=no">
    <title>Title</title>
    <script type="text/javascript" src="../static/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="../static/jquery.form.js"></script>
    <link type="text/css" rel="stylesheet" href="../static/bootstrap-3.3.7-dist/css/bootstrap.css"></link>
    <script type="text/javascript" src="../static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <script type="text/javascript">
        $(function(){
            $("#newUserName").blur(function () {
                $("#userNameTip").text("")
                var newName = $(this).val().trim()
                $(this).val(newName)
                if(newName.trim()==""){
                    $("#userNameTip").text("用户名不能为空")
                    $("#userNameTip").css("color", "red")
                    $("#userNameTip").attr("useable", "false")
                    return
                }else{
                    var newName = $("#newUserName").val().trim()
                    console.log(newName)
                    console.log("newName----" + newName)
                    $.ajax({
                        url: '/checkUserName/' + newName,
                        type: 'get',
                        success: function(data){
                            console.log(data)
                            if(data.data==false){
                                $("#userNameTip").text("用户名已存在")
                                $("#userNameTip").css("color", "red")
                                $("#userNameTip").attr("useable", "false")
                            }else if(data.data==true){
                                $("#userNameTip").text("用户名可以使用")
                                $("#userNameTip").css("color", "green")
                                $("#userNameTip").attr("useable", "true")
                            }
                        }
                    })
                }
            })

            $("#commitUserName").click(function(){
                console.log($("#userNameTip").attr("useable"))
                if($("#userNameTip").attr("useable")==false){
                    return false;
                }else{
                    var newUserName = $("#newUserName").val().trim()
                    $.ajax({
                        url: '/user/userName/change',
                        type: 'post',
                        data: {
                            'userName': newUserName
                        },
                        success: function(data){
                            if(data.code==0){
                                alert("修改成功")
                                $("#userName").text(newUserName);
                                return;
                            }else{
                                if(data.hint)
                                    alert(data.hint)
                                return false;
                            }
                        }
                    })
                    return true;
                }
            })

            $("#uploadForm").ajaxForm(function(data){
                console.log(data)
                var imgPath = data.data.imgPath
                var targetDiv = $("#imgPlace")
                targetDiv.empty();
                targetDiv.append('<img src="'+ imgPath+'" style="height:100%" picName="'+ data.data.imgName+'"/>');
            });

            $("#userPicChangeBtn").click(function(){
                var src = $(this).parent().parent().find("#imgPlace > img").attr("src")
                // alert(src)
                if(src){
                    $.ajax({
                        url: '/user/pic/change',
                        type: 'post',
                        dataType: 'json',
                        data: {
                            'picPath': src
                        },
                        success: function(data){
                            console.log(data)
                            if(data.code==0) {
                                $("#userImg").attr("src", src)
                                $("#navUserPic").attr("src", src)
                                alert("修改成功")
                                return true;
                            }
                            else{
                                if(data.hint){
                                    alert(data.hint)
                                }
                                return false;
                            }
                        }
                    })
                }else{
                    alert("未提交图片")
                    return false
                }
                return true;
            })



        })
    </script>
</head>
<body>
<div class="container">

    <div class="row">
        <div class="col-sm-1 col-md-1">
        </div>
        <div class="col-sm-10 col-md-10">
            <nav class="navbar navbar-default" role="navigation">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#" style="text-align: center; color: #2e6da4; font-weight:bold;">个人中心</a>
                    </div>
                    <div>
                        <ul class="nav navbar-nav">
                            <li class="dropdown"><a href="/toPost" target="_blank">社区首页</a></li>
                            <li><a href="/toArticle" target="_blank">文章</a></li>
                            <li><a href="/toQuestion" target="_blank">问答</a></li>
                        </ul>
                    </div>
                    <div>
                        <ul class="nav navbar-nav navbar-right">
                            <li th:if="${session.user}">
                                <div>
                                    <div class="dropdown" align="left">
                                        <span class="dropdown-toggle" id="menu1" data-toggle="dropdown" >
                                             <img id="navUserPic" width="45px" th:src="@{${session.user.userPic}}" src="../static/img/da8e974dc_xs.jpg" class="img-thumbnail"/>
                                        </span>
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                                            <li role="presentation"><a role="menuitem" tabindex="-1" href="/toHomePage" target="_blank">个人中心</a></li>
                                            <li role="presentation"><a role="menuitem" tabindex="-1" href="">退出登录</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li th:if="${session.user==null}"><a href="/toRegister" target="_blank"><span class="glyphicon glyphicon-user"></span> 注册</a></li>
                            <li th:if="${session.user==null}"><a href="/toLogin" target="_blank"><span class="glyphicon glyphicon-log-in"></span> 登录</a></li>
                        </ul>
                    </div>

                </div>
            </nav>
            <div class="col-sm-2">
                <ul class="nav nav-pills nav-stacked" role="tablist" id="selectBtn">
                    <li class="active"><a href="#" >我的帐号</a></li>
                    <li><a href="#">我的发表</a></li>
                    <li><a href="#" class="mycollect">我的收藏</a></li>
                    <li><a href="#">问题关注</a></li>
                </ul>
            </div>

            <!--我的帐号部分-->
            <div id="account" class="col-sm-8">
                <table class="table" th:if="${session.user!=null}">
                    <tr>
                        <td>帐号名</td>
                        <td th:text="${session.user.userName}" id="userName">Madao</td>
                        <td><a href="#" data-toggle="modal" data-target="#userNameModal">修改</a></td>
                        <!--<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">开始演示模态框</button>-->
                        <!-- 模态框（Modal） -->
                        <div class="modal fade" id="userNameModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="userNameModalLabel">修改用户名</h4>
                                    </div>
                                    <div class="modal-body">
                                        <input type="text" class="form-control" id="newUserName" placeholder="请输入新用户名"/>
                                        <br/>
                                        <div style="color: red" useable="false" id="userNameTip"></div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="commitUserName">提交更改</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>

                    </tr>
                    <tr>
                        <td>头像</td>
                        <td><img id="userImg" width="85px" th:src="@{${session.user.userPic}}"></td>
                        <td><a href="#" data-toggle="modal" data-target="#userPicModel">修改</a></td>
                        <div class="modal fade" id="userPicModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                        <h4 class="modal-title" id="myModalLabel">修改头像</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div>
                                            <div style="border-bottom: 2px solid lightgray" >
                                            <div style="padding: 10px">
                                                <div id="imgPlace" style="width: 100%; height: 200px" >请选择图片</div>
                                                <form id="uploadForm" action="/pic/upload" method="post"  enctype="multipart/form-data">
                                                    <input name="file" type="file" value="选择图片" />
                                                    <button class="btn btn-primary commitImg">提交</button>
                                                </form>
                                                </div>
                                            </div>
                                            <!--<div></div>-->
                                            <!--<div><input type="file"></div>-->
                                            <!--<button class="btn btn-default" id="commitUserPic">提交</button>-->
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" >关闭</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="userPicChangeBtn" >提交更改</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->
                        </div>

                    </tr>
                    <tr>
                        <td>密码</td>
                        <td>已设置</td>
                        <td><a href="#">修改</a></td>
                    </tr>
                    <tr>
                        <td>绑定手机</td>
                        <td th:text="${(session.user.phone==null || session.user.phone=='') ? '未绑定' : session.user.phone}">13420110105</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>绑定邮箱</td>
                        <td th:text="${(session.user.email==null || session.user.email=='') ? '未绑定' : session.user.email}">未绑定</td>
                        <td><a  href="#">绑定</a></td>
                    </tr>
                </table>
            </div>

            <!--我的收藏部分-->
            <div id="collect" class="col-sm-8">
                <ul class="nav nav-pills" role="tablist">
                    <li class="active"><a href="#" >帖子收藏</a></li>
                    <li><a href="#">问答收藏</a></li>
                    <li><a href="#" class="mycollect">文章收藏</a></li>
                </ul>
            </div>
	、<!--
            <ul style="width: 100%">
                <li style="display: inline; width: 30%">aa</li>
                <li style="display: inline; width: 30%">bb</li>
                <li style="display: inline; width: 30%;">cc</li>
            </ul>
	-->
        </div>
        </div>
    </div>
</body>
</html>
