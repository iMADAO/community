<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=device-width,
                                     initial-scale=1.0,
                                     maximum-scale=1.0,
                                     user-scalable=no">
    <title>Title</title>
    <script type="text/javascript" th:src="@{~/static/jquery-1.12.4.min.js}"></script>
    <link type="text/css" rel="stylesheet" th:href="@{~/static/bootstrap-3.3.7-dist/css/bootstrap.css}"></link>
    <script type="text/javascript" th:src="@{~/static/bootstrap-3.3.7-dist/js/bootstrap.js}"></script>
    <script type="text/javascript">
        $(function() {
            var pageSize = 1;
            $("#logoutNode").click(function () {
                $.ajax({
                    url: '/user/logout',
                    type: 'get',
                    success: function (data) {
                        if (data.code == 0) {
                            alert("退出登录成功")
                            $("#userNav").empty();
                            $("#userNav").append('<li ><a href="/toRegister" target="_blank"><span class="glyphicon glyphicon-user"></span> 注册</a></li>\n' +
                                '<li ><a href="/toLogin" target="_blank"><span class="glyphicon glyphicon-log-in"></span> 登录</a></li>');
                        } else {
                            alert("请稍后重试")
                        }
                        return false;
                    },
                    error: function () {
                        alert("请稍后重试")
                        return false;
                    }
                })
                return false;
            })

            $(".addComment").click(function () {
                var segmentId = $(this).parent().parent().attr("segmentId")
                var commentInputNode = $(this).parent().find(".inputComment");
                var commentInput = commentInputNode.val();
                console.log(segmentId)
                if(commentInput=="") {
                    console.log("commentInput empty")
                    alert("评论内容不能为空")
                    return false;
                }
                $.ajax({
                    url: '/post/comment/' + segmentId,
                    type:'post',
                    dataType: 'json',
                    data: {
                        'commentContent': commentInput
                    },
                    success: function(data){
                        if(data.code==0){
                            commentInputNode.val("")
                            alert("添加成功")
                        }else{
                            if(data.hint){
                                alert(data.hint)
                            }
                        }
                    },
                    error: function(){
                        alert("请稍后重试")
                    }
                })
            })
        })
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-1">
        </div>
        <div class="col-sm-9" style="border-left: 1px solid #d5d5d5; border-right: 1px solid darkgray">
            <nav class="navbar navbar-default" role="navigation">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="#" style="text-align: center; color: #2e6da4; font-weight:bold;">网络社区</a>
                    </div>
                    <div>
                        <ul class="nav navbar-nav">
                            <li class="dropdown"><a href="/toIndex" target="_blank">社区首页</a></li>
                            <li><a href="/toArticle" target="_blank">文章</a></li>
                            <li><a href="/toQuestion" target="_blank">问答</a></li>
                        </ul>
                    </div>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-default">进入社区</button>
                    </form>
                    <div>
                        <ul class="nav navbar-nav navbar-right" id="userInfo">
                            <li th:if="${session.user}" id="userCenter">
                                <div>
                                    <div class="dropdown">
                                        <span class="dropdown-toggle" id="menu1" data-toggle="dropdown" >
                                             <img width="45px" src="../static/img/da8e974dc_xs.jpg" class="img-thumbnail"/>
                                        </span>
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                                            <li role="presentation"><a role="menuitem" tabindex="-1" href="/toHomePage" target="_blank">个人中心</a></li>
                                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="logout">退出登录</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </li>

                            <li th:if="${session.user==null}" id="register"><a href="/toRegister" target="_blank"><span class="glyphicon glyphicon-user"></span> 注册</a></li>
                            <li th:if="${session.user==null}" id="login"><a href="/toLogin" target="_blank"><span class="glyphicon glyphicon-log-in"></span> 登录</a></li>
                        </ul>
                    </div>
                </div>

            </nav>

            <div class="panel panel-default" th:each="segment:${data.data.list}" th:segmentId="${segment.segmentId}">
                <div style="width: 100px; height:100%; float: left; padding: 5px">
                    <img class="img-rounded" style="width:70%; padding: 3px;"  th:src="@{${segment.userPic}}" alt="图片" /><br/><br/>
                    <span style="text-align: center; color: darkgray;"><a th:text="${segment.userName}"></a></span>
                </div>
                <div class="segmentContent" style="width: 80%; height:100%; float: left; padding: 10px" th:each="content:${segment.contentList}">
                    <p th:if="${content.type==0}" th:text="${content.content}"> 大家好，我月球鸽子皇时隔一年又来咕咕咕测试了，GS75皇帝版到手用了也有两周多了，中间换了下内存和硅脂，当初3月底换机器曾想了一晚上，本来已经下单国行GX701，因为开始GS75只有80W的2080VBIOS，性能表现比GX701弱10%，老莱同志的吹水视频理论性测试更是能差15%，但是在我下单后，PY人士告诉我GS75的90W VBIOS已经UPUP，果断退订GX701上GS75皇帝版，省下五千多，可以买一条2T蓝盘+2T EX950还有多，拓展性万岁</p>
                    <img th:if="${content.type==0}" th:src="@{${content.content}}" style="width: 85%; padding: 10px"/>
                </div>
                <div th:each="comment:${segment.postComment.list}" class="comment" style="width: 80%; height:100%; float: right; background-color: #F7F8FA">
                    <table  width="100%">
                        <tr>
                            <td width="15%"><img src="@{${comment.userPic}}" width="30px"/></td>
                            <td><span th:text="${comment.userName}">sky</span>:<span th:text="${comment.commentContent}">楼主 gs75和thinkpad的键盘 革命的机械键盘比 哪个手感会好点啊</span></td>

                        </tr>
                        <tr>
                            <td></td>
                            <td th:text="${comment.createTime}" style="text-align: right">2019-04-01</td>
                        </tr>
                    </table>

                </div>
                <br/><br/>
                <div style="float: right; width: 70%;"><input class="form-control inputComment" type="text" placeholder="我的评论" width="70%"><button  class="btn btn-default addComment" style="float: right">提交</button></div>

            </div>
            <ul class="pagination">
                <li><a href="#">&laquo;</a></li>
                <li><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">&raquo;</a></li>
            </ul>
        </div>
        <div class="col-sm-2">
        </div>
    </div>
</div>
</body>
</html>
