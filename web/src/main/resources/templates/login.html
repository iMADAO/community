<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=device-width,
                                     initial-scale=1.0,
                                     maximum-scale=1.0,
                                     user-scalable=no">
    <title>Title</title>
    <script type="text/javascript" src="../static/jquery-1.12.4.min.js"></script>
    <link type="text/css" rel="stylesheet" href="../static/bootstrap-3.3.7-dist/css/bootstrap.css"></link>
    <script type="text/javascript" src="../static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>

    <script type="text/javascript">
        $(function(){
            $("#account").blur(function(){
                checkAccount($("#account"));
            })



            $("#password").blur(function () {
                checkPassword($("#password"))
            })

            $("#submit").click(function(){
               var accountFlag = checkAccount($("#account"));
               var passwordFlag = checkPassword($("#password"));
               if(!(accountFlag&&passwordFlag)){
                    return false;
               }
                $.ajax({
                    url: '/login',
                    type: 'post',
                    data:{
                        account: $("#account").val(),
                        password: $("#password").val()
                    },
                    datatype: 'json',
                    success: function(data){
                        console.log(data)
                        if(data.code!=0){
                            alert(data.hint)
                        }else{
                            alert("登录成功");
                            var lastPage = $("#lastPage").text()
                            if(lastPage){
                                location.href = lastPage
                            } else {
                                location.href = "/toPost";
                            }

                        }
                    }
                })
                return false;
            })
            
            function checkAccount(account) {

                var value = account.val().trim();
                account.val(value);
                if(value==""){
                    account.parent().next().text("帐号不能为空")
                    return false;
                }
                if(!isPhoneNo(value) && !isEmail(value)){
                    account.parent().next().text("帐号格式不正确")
                    return false;
                }
                account.parent().next().text("");
                return true;
            }

            function checkPassword(password){
                var value = password.val().trim();
                password.val(value);
                if(value==""){
                    password.parent().next().text("密码不能为空");
                    return false;
                }
                password.parent().next().text("");
                return true;
            }
        })


        //检验电话号码格式
        function isPhoneNo(phone) {
            var pattern = /^1[34578]\d{9}$/;
            return pattern.test(phone);
        }

        //检验邮箱格式
        function isEmail(email){
            var pattern = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            return pattern.test(email);
        }

    </script>
</head>
<!--<body>-->
<!--<p>欢迎登录</p>-->
<!--<form method="post" action="">-->
    <!--用户名: <input type="text" id="name"/><br/>-->
    <!--密码: <input type="password" id="password"><br/>-->
    <!--<input type="submit" value="提交">-->
<!--</form>-->
<!--</body>-->
<body style="background-color: #F7F8FA">
​
<div class="container">

    <div class="row" >
        <div class="col-sm-4">
        </div>
        <div class="col-sm-4" >
            <br/><br/><br/><br/>
            <div align="center">
                <div>
                    <h3 style="text-align: center; color: #2e6da4; font-weight:bold;">登录</h3>
                </div>
                <br/>
                <span id="lastPage" th:if="${lastPage!=null}" th:text="${lastPage}" style="visibility: hidden"></span>
               <form action="/login" method="post">
                   <table>
                       <tr>
                           <td><input name="account" class="form-control" type="text" id="account" placeholder="请输入邮箱/电话号码"></td>
                           <td style="color: red"></td>
                       </tr>
                       <tr>
                           <td><input name="password" class="form-control" type="password" placeholder="请输入密码" id="password"></td>
                           <td style="color: red"></td>
                       </tr>
                       <tr>
                           <td>&nbsp</td>
                           <td><a href="/toRetrieve" >忘记密码?</a></td>
                       </tr>
                       <tr>
                           <td ><input type="submit" value="提交" id="submit" class="btn btn-primary" style="width: 100%"></td>
                       </tr>
                       <tr>
                           <td style="background-color: #F6F6F6; text-align: center">没有帐号?<a href="/toRegister">注册?</a></td>
                       </tr>
                   </table>
               </form>
        </div>
    </div>
</div>
​
</body>
</html>